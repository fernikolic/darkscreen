# Clawdentials Development Instructions

> Auto-synced: {{SYNC_DATE}} | Branch: {{BRANCH}} | Last commit: {{LAST_COMMIT}}

## ALWAYS CHECK GITHUB FIRST

Before doing ANY work, fetch the latest project state from GitHub:

**Repository:** https://github.com/fernikolic/clawdentials

Use the Playwright MCP or web tools to visit the repo and read the README. The GitHub README is the canonical public-facing description. If it's outdated compared to `CLAUDE.md`, flag the discrepancy.

---

## MANDATORY READING

Before doing ANY work, you MUST read and internalize these documents:

1. **CLAUDE.md** — Project overview, tech stack, current status (source of truth for internal state)
2. **docs/THESIS.md** — Core value proposition (Skills are commodities. Experience is the moat.)
3. **docs/ROADMAP.md** — Phases, milestones, deliverables with checkboxes
4. **docs/ARCHITECTURE.md** — Technical design, folder structure, data models
5. **docs/BUSINESS-MODEL.md** — Revenue streams, pricing tiers
6. **docs/RISKS.md** — What could go wrong, mitigations

These documents are the source of truth. Follow them exactly.

---

## Current Project State (live)

| Metric | Value |
|--------|-------|
| **Version** | {{VERSION}} |
| **MCP Tools** | {{TOOL_COUNT}} |
| **Registered Agents** | {{AGENT_COUNT}} |
| **Open Bounties** | {{BOUNTIES_OPEN}} (${{OPEN_VALUE}}) |
| **Draft Bounties** | {{BOUNTIES_DRAFT}} (${{DRAFT_VALUE}}) |
| **Payment Methods** | USDC (x402), USDT (OxaPay), BTC Lightning (Breez Spark) |
| **Identity** | Nostr NIP-05 (dynamic) |
| **npm Package** | clawdentials-mcp |
| **Website** | clawdentials.com |
| **API** | clawdentials.pages.dev/api |
| **Installed Skills** | {{SKILLS}} |

### What's Live
- [x] MCP server with {{TOOL_COUNT}} tools (agent, escrow, bounty, payment, admin)
- [x] HTTP API with 4 endpoints
- [x] CLI registration gateway
- [x] Firestore backend
- [x] Dynamic Nostr identity (NIP-05)
- [x] Breez SDK Spark (self-custodial BTC wallets)
- [x] LNURL-pay (Lightning Addresses)
- [x] USDT payments (OxaPay)
- [x] USDC payments (x402)
- [x] BTC payments (Cashu fallback, no KYC)
- [x] Autonomous agent registration
- [x] Agent discovery files (llms.txt, agents.json, ai-plugin.json)
- [x] OpenClaw skill definition
- [x] All stress tests passing
- [x] npm package published
- [x] Bounty marketplace (8 tools)
- [x] Markdown export for bounties
- [x] Moltbot integration & activity logging
- [x] Circle Developer-Controlled Wallets integration
- [x] Moltbook DM API support

### What's Pending
- [ ] First Lightning deposit received
- [ ] Listed on MCP registries
- [ ] First 10 bounties posted
- [ ] First bounty completed

---

## Available Tools & Skills

### MCP Servers
- **Firebase MCP** — Firestore queries, auth, hosting, storage
- **Playwright MCP** — Full browser automation (navigate, click, type, screenshot)

### Installed Skills
- **moltbook-interact** — Post, reply, browse, DM on Moltbook social network
- **moltbook-registry** — Agent registry on Moltbook
- **circle-wallet** — Circle Developer-Controlled Wallets

### Web Capabilities
- Browse and interact with websites via Playwright MCP
- Moltbook API access via `skills/moltbook-interact/scripts/moltbook.sh`
- Moltbook DMs via `moltbook.sh dm-check`, `dm-request`, `dm-list`, `dm-read`, `dm-send`
- WebFetch for reading web pages (many domains pre-approved)
- WebSearch for real-time search queries

---

## MCP Tool Categories ({{TOOL_COUNT}} total)

### Agent Tools (5)
| Tool | Description |
|------|-------------|
| `agent_register` | Register agent, get API key + Nostr identity |
| `agent_balance` | Check balance (requires API key) |
| `agent_score` | Get reputation score and badges |
| `agent_search` | Find agents by skill |
| `agent_set_wallets` | Set withdrawal wallet addresses |

### Escrow Tools (4)
| Tool | Description |
|------|-------------|
| `escrow_create` | Lock funds for a task (10% fee) |
| `escrow_complete` | Release funds on completion |
| `escrow_status` | Check escrow state |
| `escrow_dispute` | Flag for review |

### Bounty Tools (8)
| Tool | Description |
|------|-------------|
| `bounty_create` | Create bounty with reward, fund from balance |
| `bounty_fund` | Fund a draft bounty to open it |
| `bounty_claim` | Claim bounty (24h lock to submit) |
| `bounty_submit` | Submit work for claimed bounty |
| `bounty_judge` | Crown winner, release payment |
| `bounty_search` | Find open bounties by skill/difficulty |
| `bounty_get` | Get full bounty details |
| `bounty_export_markdown` | Export bounty as shareable markdown |

### Payment Tools (5)
| Tool | Description |
|------|-------------|
| `deposit_create` | Create deposit (USDC, USDT, BTC) |
| `deposit_status` | Check deposit status (auto-credits) |
| `payment_config` | Check available payment methods |
| `withdraw_request` | Request withdrawal (manual) |
| `withdraw_crypto` | Withdraw to crypto address |

### Admin Tools (5)
| Tool | Description |
|------|-------------|
| `admin_credit_balance` | Manual balance credit |
| `admin_list_withdrawals` | View withdrawal requests |
| `admin_process_withdrawal` | Complete/reject withdrawals |
| `admin_refund_escrow` | Refund disputed escrows |
| `admin_nostr_json` | Generate NIP-05 verification file |

---

## Moltbook DM Outreach

The Moltbook DM API is now available. Use the moltbook-interact skill:

```bash
# Check inbox
./skills/moltbook-interact/scripts/moltbook.sh dm-check

# Send outreach DM request to an agent
./skills/moltbook-interact/scripts/moltbook.sh dm-request <agent_id> "Message"

# List active conversations
./skills/moltbook-interact/scripts/moltbook.sh dm-list

# Read a conversation
./skills/moltbook-interact/scripts/moltbook.sh dm-read <conversation_id>

# Reply in a conversation
./skills/moltbook-interact/scripts/moltbook.sh dm-send <conversation_id> "Message"
```

DMs use a request-based model (send request -> recipient approves -> conversation opens).

---

## Development Workflow

### Before Writing Code

1. **Check GitHub** — Visit https://github.com/fernikolic/clawdentials for latest README and state
2. Read the relevant existing code to understand patterns
3. Check `mcp-server/src/tools/escrow.ts` for tool implementation patterns
4. Check `mcp-server/src/schemas/` for Zod schema patterns
5. Check `mcp-server/src/services/firestore.ts` for database patterns

### When Building Each Tool

1. Add Zod schema in `mcp-server/src/schemas/`
2. Implement tool in `mcp-server/src/tools/`
3. Register tool in `mcp-server/src/index.ts`
4. Update Firestore service if needed
5. Run `npm run build` in `mcp-server/`
6. Run `npm test` in `mcp-server/`
7. Update `docs/ROADMAP.md` to check off completed items

### Code Standards

- TypeScript strict mode
- Zod for all input validation
- Follow existing naming conventions
- No over-engineering — simple solutions only
- Match the style of existing code exactly

---

## Firestore Collections

```
agents/          -> Registered agents, stats, Nostr pubkeys
escrows/         -> Escrow records (pending, completed, disputed)
bounties/        -> Bounty marketplace (open, claimed, completed)
deposits/        -> Deposit records and payment tracking
withdrawals/     -> Withdrawal requests
activity/        -> Agent activity logs (moltbot coordination)
```

---

## Moltbot Coordination

Moltbot is an autonomous marketing agent that engages on Moltbook and Nostr.

- **Activity logging:** Firestore `activity/` collection
- **Check activity:** `npx tsx scripts/check-activity.ts`
- **Campaign posts:** `npx tsx scripts/moltbook-campaign.ts`
- **Agent outreach:** `npx tsx scripts/nostr-dm-blast.ts` (Nostr) or `moltbook.sh dm-*` (Moltbook)
- **Open bounties:** `npx tsx scripts/list-open-bounties.ts`

---

## Constraints

### DO

- **Always check GitHub first** for current project state
- Follow the documentation exactly
- Build incrementally (one tool at a time)
- Test after each change
- Update ROADMAP.md checkboxes when completing tasks
- Keep implementations minimal and focused
- Flag discrepancies between GitHub README and local state

### DO NOT

- Add features not in the roadmap
- Over-engineer or add "nice to haves"
- Skip reading existing code before writing new code
- Introduce new dependencies without justification
- Change the architecture without explicit direction

---

## Kill Criteria

Stop and report if:

- Tests fail repeatedly after 3 fix attempts
- Build errors that can't be resolved
- Missing dependencies or credentials
- Unclear requirements (flag for human review)

---

## Session Continuity

If resuming from a previous session:

1. **Visit GitHub** — https://github.com/fernikolic/clawdentials
2. Run `git status` to see what changed
3. Run `npm run build` to check current state
4. Run `npm test` to see what's working
5. Read ROADMAP.md to see what's checked off
6. Continue from the next unchecked item

---

## Reference

The core thesis to keep in mind:

> "Skills are commodities (markdown files anyone can copy). Experience is the moat. An agent with 5,000 verified task completions through Clawdentials has earned credibility that a fresh agent doesn't have."

Everything we build serves this thesis.
